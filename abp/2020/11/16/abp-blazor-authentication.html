<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="alternate icon" class="js-site-favicon" type="image/png" href="https://github.githubassets.com/favicons/favicon.png">
  <link rel="icon" class="js-site-favicon" type="image/svg+xml" href="https://github.githubassets.com/favicons/favicon.svg"><!-- Begin Jekyll SEO tag v2.7.1 -->
<title>abp集成ant blazor认证 | 野程序猿</title>
<meta name="generator" content="Jekyll v4.2.0" />
<meta property="og:title" content="abp集成ant blazor认证" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="添加认证回调 在Pages文件中添加名为”Authentication.razor”文件并输入如下代码。 ```C# @page “/authentication/{action}” @using Microsoft.AspNetCore.Components.WebAssembly.Authentication" />
<meta property="og:description" content="添加认证回调 在Pages文件中添加名为”Authentication.razor”文件并输入如下代码。 ```C# @page “/authentication/{action}” @using Microsoft.AspNetCore.Components.WebAssembly.Authentication" />
<link rel="canonical" href="struggle3.github.io/blog.github.io/blog.github.io/abp/2020/11/16/abp-blazor-authentication.html" />
<meta property="og:url" content="struggle3.github.io/blog.github.io/blog.github.io/abp/2020/11/16/abp-blazor-authentication.html" />
<meta property="og:site_name" content="野程序猿" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2020-11-16T22:00:00+08:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="abp集成ant blazor认证" />
<script type="application/ld+json">
{"datePublished":"2020-11-16T22:00:00+08:00","dateModified":"2020-11-16T22:00:00+08:00","mainEntityOfPage":{"@type":"WebPage","@id":"struggle3.github.io/blog.github.io/blog.github.io/abp/2020/11/16/abp-blazor-authentication.html"},"@type":"BlogPosting","url":"struggle3.github.io/blog.github.io/blog.github.io/abp/2020/11/16/abp-blazor-authentication.html","description":"添加认证回调 在Pages文件中添加名为”Authentication.razor”文件并输入如下代码。 ```C# @page “/authentication/{action}” @using Microsoft.AspNetCore.Components.WebAssembly.Authentication","headline":"abp集成ant blazor认证","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/blog.github.io/assets/main.css">
  <link rel="stylesheet" href="/blog.github.io/assets/style.css"><link type="application/atom+xml" rel="alternate" href="struggle3.github.io/blog.github.io/blog.github.io/feed.xml" title="野程序猿" />
</head>
<body><header class="site-header">

  <div class="wrapper"><a class="site-title" rel="author" href="/blog.github.io/">野程序猿</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/blog.github.io/about/imdex.html">关于自己</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">abp集成ant blazor认证</h1>
    <p class="post-meta"><time class="dt-published" datetime="2020-11-16T22:00:00+08:00" itemprop="datePublished">
        2020-11-16 22:00:00
      </time></p>
  </header>

  <div class="post-content e-content" itemprop="articleBody">
    <h2 id="添加认证回调">添加认证回调</h2>
<p>在Pages文件中添加名为”Authentication.razor”文件并输入如下代码。</p>
<pre><code class="language-C#">@page "/authentication/{action}"
@using Microsoft.AspNetCore.Components.WebAssembly.Authentication
&lt;RemoteAuthenticatorView Action="@Action" /&gt;

@code{
    [Parameter] 
    public string Action { get; set; }
}
</code></pre>
<h2 id="渲染菜单">渲染菜单</h2>
<h3 id="重写菜单">重写菜单</h3>
<p>继承IMenuContributor接口并重写ConfigureMenuAsync方法加入以下代码。</p>
<pre><code class="language-C#">public async Task ConfigureMenuAsync(MenuConfigurationContext context)
        {

            if (context.Menu.Name != StandardMenus.Main)
            {
                return;
            }

            var appLocalizer = context.GetLocalizer&lt;MyAbpResource&gt;();
            var tenantLocalizer = context.GetLocalizer&lt;AbpTenantManagementResource&gt;();

            context.Menu.Items.Insert(
                0,
                new ApplicationMenuItem(
                    "MyAbp.Home",
                    appLocalizer["Menu:Home"],
                    "/",
                    icon: "home"
                )
            );


            var administrationMenu = context.Menu.GetAdministration();
            administrationMenu.Items.RemoveAll(m =&gt; true);
            administrationMenu.Icon = "global";
            administrationMenu.Url = "/admin";

            var tenantManagementMenuItem = new ApplicationMenuItem(TenantManagementMenuNames.GroupName, tenantLocalizer["Menu:TenantManagement"], url: "/tenant-management", icon: "solution");
            administrationMenu.AddItem(tenantManagementMenuItem);
            if (await context.IsGrantedAsync(TenantManagementPermissions.Tenants.Default))
            {
                tenantManagementMenuItem.AddItem(new ApplicationMenuItem(TenantManagementMenuNames.Tenants, tenantLocalizer["Tenants"], url: "/tenant-management/tenants"));
            }

            var hasRolePermission = await context.IsGrantedAsync(IdentityPermissions.Roles.Default);
            var hasUserPermission = await context.IsGrantedAsync(IdentityPermissions.Users.Default);

            if (hasRolePermission || hasUserPermission)
            {
                var identityLocalizer = context.GetLocalizer&lt;IdentityResource&gt;();

                var identityMenuItem = new ApplicationMenuItem(IdentityMenuNames.GroupName, identityLocalizer["Menu:IdentityManagement"], url:"/identity", icon: "team");
                administrationMenu.AddItem(identityMenuItem);

                if (hasRolePermission)
                {
                    identityMenuItem.AddItem(new ApplicationMenuItem(IdentityMenuNames.Roles, identityLocalizer["Roles"], url: "/identity/roles"));
                }

                if (hasUserPermission)
                {
                    identityMenuItem.AddItem(new ApplicationMenuItem(IdentityMenuNames.Users, identityLocalizer["Users"], url: "/identity/users"));
                }
            }
        }
</code></pre>
<h3 id="获取菜单">获取菜单</h3>
<p>在MainLayout.razor文件中替换如下代码。</p>
<pre><code class="language-C#">@inherits LayoutComponentBase
@using Volo.Abp.Ui.Branding
@using Volo.Abp.UI.Navigation;
@inject IBrandingProvider BrandingProvider
&lt;AntDesign.Pro.Layout.BasicLayout Logo="@("https://gw.alipayobjects.com/zos/rmsportal/KDpgvguMpGfqaHPjicRK.svg")" MenuData="NavMenu.ToArray()"&gt;
    &lt;RightContentRender&gt;

    &lt;/RightContentRender&gt;
    &lt;ChildContent&gt;
        @Body
    &lt;/ChildContent&gt;
&lt;/AntDesign.Pro.Layout.BasicLayout&gt;
@code
{
    private List&lt;MenuDataItem&gt; NavMenu { get; set; }

    [Inject]
    protected IMenuManager MenuManager { get; set; }

    protected override async Task OnInitializedAsync()
    {
        await base.OnInitializedAsync();

        CreateMenu(await MenuManager.GetAsync(StandardMenus.Main));
    }

    protected void CreateMenu(ApplicationMenu Menu)
    {
        NavMenu = new List&lt;MenuDataItem&gt;();

        foreach (var item in Menu.Items)
        {
            var menu = new MenuDataItem()
            {
                Path = item.Url,
                Name = item.DisplayName,
                Key = item.Name,
                Icon = item.Icon
            };

            if (item.Items.Count&gt;0)
                menu.Children = CreateChildMenu(item).ToArray();

            NavMenu.Add(menu);
        }
    }

    protected List&lt;MenuDataItem&gt; CreateChildMenu(ApplicationMenuItem Menu)
    {
        List&lt;MenuDataItem&gt; menu = new List&lt;MenuDataItem&gt;();
        foreach (var item in Menu.Items)
        {
            var child = new MenuDataItem()
            {
                Path=item.Url,
                Name = item.DisplayName,
                Key = item.Name,
                Icon = item.Icon
            };

            if (item.Items.Count&gt;0)
                child.Children = CreateChildMenu(item).ToArray();
            
            menu.Add(child);
        }
        return menu;
    }
}
</code></pre>
<h2 id="效果图">效果图</h2>
<p><img src="/blog.github.io/images/03.png" alt="" /></p>

  </div><a class="u-url" href="/blog.github.io/abp/2020/11/16/abp-blazor-authentication.html" hidden></a>
</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/blog.github.io/"></data>

  <div class="wrapper">

    <div class="footer-col-wrapper">
      <div class="footer-col">
        <p class="feed-subscribe">
          <a href="/blog.github.io/feed.xml">
            <svg class="svg-icon orange">
              <use xlink:href="/blog.github.io/assets/minima-social-icons.svg#rss"></use>
            </svg><span>订阅博客</span>
          </a>
        </p>
      </div>
      <div class="footer-col">
        <p>记录自己的生活。</p>
      </div>
    </div>
  </div>

</footer>
</body>

</html>
