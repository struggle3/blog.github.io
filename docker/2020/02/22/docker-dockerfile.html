<!DOCTYPE html>
<html lang="zh">

<head>
    <meta charset="UTF-8">
    <title>ye程序员</title>
    <meta name="baidu-site-verification" content="code-9dLmWXu6Zd" />
	<link rel="icon" href="/assets/images/favicon.ico">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="keywords" content="DockerFile" />
    <meta name="description" content="介绍DockerFile文件" />
    <script src="/assets/js/jquery.min.js"></script>
    <script src="/assets/js/bootstrap.min.js"></script>
    <link href="/assets/css/bootstrap.min.css" rel="stylesheet" type="text/css">
    <link href="/assets/css/font-awesome.min.css" rel="stylesheet" type="text/css">
    <!--[if IE 7]>
    <link rel="stylesheet" href="assets/css/font-awesome-ie7.min.css">
    <![endif]-->
    <!--[if lt IE 9]>
       <script src="https://cdn.bootcss.com/html5shiv/3.7.2/html5shiv.min.js"></script>
       <script src="https://cdn.bootcss.com/respond.js/1.4.2/respond.js"></script>
    <![endif]-->
    <link href="/assets/css/main.css" rel="stylesheet" type="text/css">



<script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?417785846428737cc886d2095c0511c3";
      var s = document.getElementsByTagName("script")[0]; 
      s.parentNode.insertBefore(hm, s);
    })();
    </script>
    

</head>

<body>

<div class="container-fluid">
    <div class="row-fluid">
        <div class="navbar navbar-custom navbar-fixed-top" role="navigation">
            <div class="navbar-header">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a class="navbar-brand" href="/">
                    <img src="/assets/images/logo.png" height="30" />
                </a>
            </div>
            <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
                <ul class="nav navbar-nav">
                    
                    <li class="active"><a href="/">首页</a></li>
                    <li class="active"><a href="/archive.html">归档</a></li>
                    <li class="active"><a href="/categories.html">分类</a></li>
                    <li class="active"><a href="/tags.html">标签</a></li>
                    <li class="active"><a href="/about.html">关于</a></li>
                </ul>
            </div>
        </div>
    </div>
</div>


<div class="wrap">
    <div class="container container-left">
        <div class="row">
            <div class="col-md-2 hidden-xs">
                
<div class="sidebar well">
    <header class="sidebar-header" role="banner">
        <a href="/">
            <img src="/assets/images/touxiang.jpg" class="img-circle" />
        </a>
        <!--
        <h3 class="title">
        <a href="/"></a>
        </h3>
        -->
    </header>
    <div class="text-center">
        欢迎来到我的博客！
    </div>
</div>


<div class="sidebar well">
    <h1>置顶文章</h1>
    <ul>
        
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
                    <li><a href="/java/2021/03/10/spring10.html">Spring MVC环境搭建</a></li>
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
        
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
                    <li><a href="/java/2021/03/02/spring02.html">Spring开发环境</a></li>
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
        
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
                    <li><a href="/java/2021/03/01/spring-overview.html">Spring简介</a></li>
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
        
            
                
            
                
            
                
            
                
            
                
            
                
            
                
                    <li><a href="/java/2021/03/11/springboot01.html">Spring Boot简介</a></li>
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
        
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
                    <li><a href="/abp/2020/12/01/abp-deployment.html">abpvnext部署</a></li>
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
        
    </ul>
</div>


<div class="sidebar well">
    <h1>最新发表</h1>
    <ul>
        
          <li><a href="/java/2021/03/17/springmvc01.html">Spring MVC</a></li>
        
          <li><a href="/java/2021/03/16/springboot06.html">Spring Boot日志</a></li>
        
          <li><a href="/java/2021/03/15/springboot05.html">Spring Boot热部署</a></li>
        
          <li><a href="/java/2021/03/14/springboot04.html">Spring Boot配置类</a></li>
        
          <li><a href="/java/2021/03/13/springboot03.html">Spring Boot属性注入配置</a></li>
        
    </ul>
</div>

<div class="sidebar well">
    
<h1>友情链接</h1>
<ul>
  <!-- <li><a href="#">One</a></li>
  <li><a href="#">Two</a></li>
  <li><a href="#">Three</a></li>
  <li><a href="#">Four</a></li> -->
  
  <li>
    <a href="http://jekyllcn.com/" target="_blank">
      jekyll中文
    </a>
  </li> 
  
</ul>

</div>

            </div>
            <div class="col-md-10">
                
<div class="well article">
        <h2><a href="/docker/2020/02/22/docker-dockerfile.html">dockerfile</a></h2>
        <span class="post-date">
            
            2020-02-22
        </span>
        <hr style="border-top:1px solid #28323C;"/>
    
    <div class="post-content">
    <h1 id="1-什么是dockerfile">1. 什么是dockerfile</h1>

<p>Dockfile是一种被docker程序解释的脚本Dockerfile是由多条指令组成，每条指令对应Linux下面的一条命令。</p>

<p>Docker程序将这些Dockerfile指令解析真正的Linux命令，Dockerfile有自己语法格式和支持的命令。</p>

<p>Docker程序将读取Dockerfile根据指令生成定制的镜像。</p>

<h1 id="2-dockerfile的基本结构">2. Dockerfile的基本结构</h1>

<p>Dockerfile分为四部分：基础镜像信息、维护者信息、镜像操作指令和容器启动时执行指令，’#’ 为 Dockerfile 中的注释。</p>

<h1 id="3-dockerfile文件说明">3. Dockerfile文件说明</h1>

<h2 id="31from指定基础-image">3.1.FROM（指定基础 image）：</h2>

<p>构建指令，必须指定且需要在Dockerfile其他指令的前面，后续的指令都依赖于该指令指定的镜像，FROM指令指定的基础镜像可以是官方远程仓库中的也可以位于本地仓库。</p>

<div class="language-dockerfile highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#示例：</span>
 FROM centos:7.2
 FROM centos
</code></pre></div></div>

<h1 id="32-maintainer指定镜像创建者信息">3.2. MAINTAINER（指定镜像创建者信息）：</h1>

<p>构建指令，用于将镜像的制作者相关的信息写入到镜像中，当我们对该镜像执行docker inspect命令时，输出中有相应的字段记录该信息。</p>

<div class="language-dockerfile highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#示例：</span>
 MAINTAINER test "test@tesm.com"
</code></pre></div></div>

<h2 id="33run执行命令">3.3.RUN（执行命令）：</h2>

<p>构建指令，RUN可以运行任何被基础镜像支持的命令，如基础镜像选择了Centos那么软件管理部分只能使用Centos的包管理命令</p>

<div class="language-dockerfile highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#示例：</span>
 RUN cd /tmp &amp;&amp; curl -L
'http://archive.apache.org/dist/tomcat/tomcat-7/v7.0.8/bin/apache-tomcat-7.0.8.tar.gz' | tar -xz
 RUN ["/bin/bash", "-c", "echo hello"]
</code></pre></div></div>

<h2 id="34-cmd设置容器启动时执行的操作">3.4. CMD（设置容器启动时执行的操作）：</h2>

<p>设置指令，用于容器启动时指定的操作，该操作可以是执行自定义脚本；也可以是执行系统命令；该指令只能在文件中存在一次如果有多个则只执行最后一条。</p>

<div class="language-dockerfile highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#示例：</span>
 CMD echo “Hello, World!”
</code></pre></div></div>

<h2 id="35-entrypoint设置容器启动时执行的操作">3.5. ENTRYPOINT（设置容器启动时执行的操作）:</h2>

<p>设置指令，指定容器启动时执行的命令可以多次设置但是只有最后一个有效。</p>

<div class="language-dockerfile highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#示例：</span>
 ENTRYPOINT ls -l
</code></pre></div></div>

<p><strong>该指令的使用分为两种情况一种是独自使用另一种和CMD指令配合使用；当独自使用时如果你还使用了CMD命令且CMD是一个完整的可执行的命令；</strong>
<strong>那么CMD指令和ENTRYPOINT会互相覆盖只有最后一个CMD或者ENTRYPOINT有效，CMD指令将不会被执行只有ENTRYPOINT指令被执行。</strong></p>

<div class="language-dockerfile highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#示例：</span>
 CMD echo “Hello, World!”
 ENTRYPOINT ls -l
</code></pre></div></div>

<p>另一种用法和CMD指令配合使用来指定ENTRYPOINT的默认参数，这时CMD指令不是一个完整的可执行命令仅仅是参数部分ENTRYPOINT指令只能使用JSON方式指定执行命令而不能指定参数。</p>

<div class="language-dockerfile highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#示例：</span>
 FROM ubuntu
 CMD ["-l"]
 ENTRYPOINT ["/usr/bin/ls"]
</code></pre></div></div>

<h2 id="36-user设置容器的用户">3.6. USER（设置容器的用户）：</h2>

<p>设置指令，设置启动容器的用户默认是root用户</p>

<div class="language-dockerfile highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#示例：</span>
 USER daemon = ENTRYPOINT ["memcached", "-u", "daemon"]
</code></pre></div></div>

<h2 id="37-expose指定于外界交互的端口">3.7. EXPOSE（指定于外界交互的端口）：</h2>

<p>设置指令，该指令会将容器中的端口映射成宿主机器中的某个端口。当你需要访问容器的时候，可以不是用容器的IP地址而是使用宿主机器的IP地址和映射后的端口。</p>

<p>整个操作需要两个步骤首先在 Dockerfile 使用 EXPOSE 设置需要映射的容器端口，然后在运行容器的时候指定-p选项加上EXPOSE设置的端口；这样EXPOSE设置的端口号会被随机映射成宿主机器中的一个端口号。</p>

<p>也可以指定需要映射到宿主机器的那个端口，这时要确保宿主机器上的端口号没有被使用EXPOSE指令可以一次设置多个端口号相应的运行容器的时候，可以配套的多次使用-p选项。</p>

<div class="language-dockerfile highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#示例：</span>
<span class="c">#映射一个端口</span>
 EXPOSE 22
<span class="c">#相应的运行容器使用的命令</span>
 docker run -p port1 image

<span class="c">#映射多个端口</span>
 EXPOSE port1 port2 port3
<span class="c">#相应的运行容器使用的命令</span>
 docker run -p port1 -p port2 -p port3 image
<span class="c">#还可以指定需要映射到宿主机器上的某个端口号</span>
 docker run -p host_port1:port1 -p host_port2:port2 -p host_port3:port3 image
</code></pre></div></div>

<h2 id="38-env用于设置环境变量">3.8. ENV（用于设置环境变量）：</h2>

<p>构建指令，在镜像中设置一个环境变量设置完成之后后续的RUN命令都可以使用容器启动后，可以通过docker inspect查看这个环境变量，也可以通过在docker run –env key=value时设置或修改环境变量。</p>

<p><strong>假如你安装了JAVA程序需要设置JAVA_HOME那么可以在Dockerfile中这样写：</strong></p>

<div class="language-dockerfile highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#示例：</span>
 ENV JAVA_HOME /path/to/java/dirent
</code></pre></div></div>

<h2 id="39-add从src复制文件到容器的dest路径">3.9 ADD（从src复制文件到容器的dest路径）</h2>

<div class="language-dockerfile highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#示例：</span>
 ADD &lt;src&gt; &lt;dest&gt;
#&lt;src&gt; 是相对被构建的源目录的相对路径可以是文件或目录的路径也可以是一个远程的文件url&lt;dest&gt; 是容器中的绝对路径
</code></pre></div></div>
<h2 id="310-copy-从sr复制文件到container的dest路径">3.10. COPY （从sr复制文件到container的dest路径）</h2>

<div class="language-dockerfile highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#示例：</span>
<span class="k">COPY</span><span class="s"> &lt;src&gt; &lt;dest&gt;</span>
</code></pre></div></div>
<h2 id="311-volume指定挂载点">3.11. VOLUME（指定挂载点）：</h2>

<p>设置指令，使容器中的一个目录具有持久化存储数据的功能该目录可以被容器本身使用也可以共享给其他容器使用，当容器中的应用有持久化数据的需求时可以在Dockerfile中使用该指令。</p>

<div class="language-dockerfile highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#示例：</span>
 FROM base
 VOLUME ["/tmp/data"]
</code></pre></div></div>

<h2 id="312-workdir切换目录">3.12. WORKDIR（切换目录）：</h2>

<p>设置指令，可以多次切换(相当于cd命令)对RUN,CMD,ENTRYPOINT生效。</p>

<div class="language-dockerfile highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#示例：</span>
 WORKDIR /p1 WORKDIR p2 RUN vim a.txt
</code></pre></div></div>

<h2 id="313-onbuild在子镜像中执行">3.13. ONBUILD（在子镜像中执行）：</h2>

<p>ONBUILD指定的命令在构建镜像时并不执行而是在它的子镜像中执行。</p>

<div class="language-dockerfile highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#示例：</span>
 ONBUILD ADD . /app/src
 ONBUILD RUN /usr/local/bin/python-build --dir /app/src 
</code></pre></div></div>

    <hr style="border-top:1px solid #28323C;"/>

    <!-- tags and categories under post -->
    
    <ul class="list-unstyled list-inline">
      <li><i class="icon-folder-open"></i></li>
      
      
         
            <li class="icon-style"><a href="/categories.html">
                docker <span>(11)</span>
                
            </a></li>
        
      
    </ul>
      

    
    <ul class="list-unstyled list-inline">
      <li><i class="icon-tags"></i></li>
      
      
         
            <li class="icon-style">
                <a href="/tags.html">
                docker <span>(11)</span>
                
                </a>
            </li>
        
      
      
    </ul>
      

    </div>
    
</div>
<div class="pagination">
    
    <a class="btn btn-default" href="/abp/2020/04/09/abp-domain.html" class="next">前一篇</a>
    
    
    <a class="btn btn-default" href="/docker/2020/02/21/docker-image.html" class="previous">后一篇</a>
    
</div>
            </div>
        </div>
    </div>

    
<div class="footer">
    <p>&copy;2021 ye程序员版权所有
             
                <a href="http://www.beian.miit.gov.cn">
                蜀ICP备19012996号-3
                </a>
                <!-- not the last, output a ',' -->
                
            
    </p>
</div>

<!-- 
    

    
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', '', 'auto');
    ga('send', 'pageview');
  </script>

 
-->

</body>
</html>

</div>